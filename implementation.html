<html>
    <head>
    </head>
    <body>
        <div style="height: 50px; width: 10000px; background-color: blue;"></div>
        <button id="button"></button>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>

        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        v
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>
        <p>Nice thanks man awesome</p>


        <template id="x-widget-template">
            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
            <link href="https://fonts.googleapis.com/css2?family=Alexandria:wght@300;400;500;600;700&display=swap" rel="stylesheet">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,300,0,0" />

            <style>
                * {
                    box-sizing: border-box;
                    --icon-default-dim: 60px;
                    --form-default-width: 350px;
                    --form-default-height: 500px;
                    --side-margin: 20px;
                    --site-falcon-purple: #AE55E7;
                }

                #icon {
                    width: var(--icon-default-dim);
                    height: var(--icon-default-dim);
                    position: fixed;
                    visibility: visible;
                    opacity: 1;
                    transition: top 0.3s ease 0s, left 0.3s ease 0s, scale 0.2s ease, transform 0.5s ease, visibility 0s linear 0.5s, opacity 0.5s linear;
                }

                #icon.location-top-left {
                    left: var(--side-margin);
                    top: var(--side-margin);
                }

                #icon.location-top-right {
                    left: calc(100% - var(--icon-default-dim) - var(--side-margin));
                    top: var(--side-margin);
                }

                #icon.location-bottom-left {
                    left: var(--side-margin);
                    top: calc(100% - var(--icon-default-dim) - var(--side-margin));
                }

                #icon.location-bottom-right {
                    left: calc(100% - var(--icon-default-dim) - var(--side-margin));
                    top: calc(100% - var(--icon-default-dim) - var(--side-margin));
                }

                #icon:hover {
                    scale: 1.05;
                }         

                #icon > img {
                    width: 100%;
                    height: 100%;
                }

                #form {
                    width: var(--form-default-width);
                    height: var(--form-default-height);
                    background-color: white;
                    border: 0px;
                    border-radius: 10px 10px 10px 10px;
                    box-shadow: 0 4px 16px rgb(0 0 0 / 25%);
                    border-radius: 15px;
                    position: fixed;
                    visibility: visible;
                    opacity: 1;
                    transition: transform 0.5s ease, visibility 0s linear 0.5s, opacity 0.5s linear;
                }

                #form.location-top-left {
                    left: var(--side-margin);
                    top: var(--side-margin);
                }

                #form.location-top-right {
                    left: calc(100% - var(--form-default-width) - var(--side-margin));
                    top: var(--side-margin);
                }

                #form.location-bottom-left {
                    left: var(--side-margin);
                    top: calc(100% - var(--form-default-height) - var(--side-margin));
                }

                #form.location-bottom-right {
                    left: calc(100% - var(--form-default-width) - var(--side-margin));
                    top: calc(100% - var(--form-default-height) - var(--side-margin));
                }

                #form-header {
                    top: 0px;
                    width: 100%;
                    height: 60px;
                    background-color: var(--site-falcon-purple);
                    border-radius: 15px 15px 0px 0px;
                    border: 0px;
                    justify-content: center;
                    align-items: center;
                    display: flex;
                }

                #form-title {
                    font-family: Alexandria, sans-serif;
                    font-weight: 400;
                    font-size: 24px;
                    color: white;
                    text-align: center;
                }

                #form-content-container {
                    width: 100%;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    padding-left: 32px;
                    padding-right: 32px;
                }

                #input-name-container {
                    width: 100%;
                    margin-top: 24px;
                    position: relative;
                }

                .md-input {
                    width: 100%;
                    border: 1px solid #c0c0c0;
                    border-radius: 4px;
                    padding: 16px;
                }

                #input-name {
                    height: 48px;
                }

                .label-md-input {
                    position: absolute;
                    top: 0;
                    left: 16px;
                    display: flex;
                    pointer-events: none;
                }

                #input-name + .label-md-input {
                    bottom: 0;
                    align-items: center;
                }

                #input-comment + .label-md-input {
                    margin-top: 15px;
                }

                .md-input, .label-md-input > div {
                    font-family: Alexandria, sans-serif;
                    font-weight: 300;
                    font-size: 16px;
                }

                .label-md-input > div {
                    transition: all 0.15s ease-out, visibility 0s;
                    color: grey;
                }

                .md-input:focus {
                    outline: none;
                    border: 2px solid var(--site-falcon-purple);
                }

                #input-name:focus + .label-md-input > div, #input-name:not(#input-name[value=""]) + .label-md-input > div {
                    font-size: 14px;
                    transform: translate(0, -150%);
                    background-color: white;
                    padding-left: 4px;
                    padding-right: 4px;
                }

                #input-comment:focus + .label-md-input > div, #input-comment:not(#input-comment[value=""]) + .label-md-input > div {
                    font-size: 14px;
                    transform: translate(0, -150%);
                    background-color: white;
                    padding-left: 4px;
                    padding-right: 4px;
                }

                .md-input:focus + .label-md-input > div {
                    color: var(--site-falcon-purple);
                }

                #select-severity-container {
                    margin-top: 24px;
                    width: 100%;
                    display: grid;
                    grid-template-columns: 1fr 1fr 1fr 1fr;
                    grid-column-gap: 0px;
                    justify-content: center;
                    align-items: center;
                }

                .severity-option {
                    margin: 0px;
                    height: 48px;
                    background-color: #ececec;
                    border: 2px solid #d3d3d3;
                    border-left: 0px;
                }

                .severity-option:hover:not(.selected) {
                    background-color: #e0e0e0;
                    cursor: pointer;
                }

                .severity-option.selected {
                    background-color: #d3d3d3;
                }

                #select-severity-container :first-child {
                    border-left: 2px solid #d3d3d3;
                    border-radius: 4px 0px 0px 4px;
                }

                #select-severity-container :last-child {
                    border-radius: 0px 4px 4px 0px;
                }

                #input-comment-container {
                    width: 100%;
                    margin-top: 24px;
                    position: relative;
                }

                #input-comment {
                    height: 150px;
                    resize: none;
                }

                #icon:not(.hidden), #form:not(.hidden) {
                    transition-delay: 0s;
                }

                #icon.hidden, #form.hidden {
                    pointer-events: none;
                    visibility: hidden;
                    opacity: 0;
                }

                #icon.hidden.location-bottom-left, #form.hidden.location-bottom-left,
                #icon.hidden.location-bottom-right, #form.hidden.location-bottom-right {
                    transform: translateY(200%);
                }

                #icon.hidden.location-top-left, #form.hidden.location-top-left,
                #icon.hidden.location-top-right, #form.hidden.location-top-right {
                    transform: translateY(-200%);
                }

                #icon.hidden {
                    scale: 1.05;
                }
            </style>

            <div id="icon">
                <img src="icon_open.png">
            </div>

            <div id="form">
                <div id="form-header">
                    <div id="form-title">
                        New Ticket
                    </div>
                </div>
                <div id="form-content-container">
                    <div id="input-name-container">
                        <input
                            type="text"
                            id="input-name"
                            class="md-input"
                            name="name"
                            value=""
                            aria-labelledby="label-input-name"
                        />
                        <label for="name" class="label-md-input">
                            <div>Name</div>
                        </label>
                    </div>
                    <div id="select-severity-container">
                        <div class="severity-option" id="option-low-severity">
                            <!-- <span class="material-symbols-rounded">
                                priority_high
                            </span> -->
                        </div>
                        <div class="severity-option" id="option-medium-severity">
                            <!-- <span class="material-symbols-rounded">
                                priority_high
                            </span>
                            <span class="material-symbols-rounded">
                                priority_high
                            </span> -->
                        </div>
                        <div class="severity-option" id="option-high-severity">
                            <!-- <span class="material-symbols-rounded">
                                priority_high
                            </span>
                            <span class="material-symbols-rounded">
                                priority_high
                            </span>
                            <span class="material-symbols-rounded">
                                priority_high
                            </span> -->
                        </div>
                        <div class="severity-option selected" id="option-no-severity">
                            <!-- <span class="material-symbols-rounded">
                                campaign
                            </span> -->
                        </div>
                    </div>
                    <div id="input-comment-container">
                        <textarea
                            type="text"
                            id="input-comment"
                            class="md-input"
                            name="comment"
                            value=""
                            aria-labelledby="label-input-comment"
                        ></textarea>
                        <label for="comment" class="label-md-input">
                            <div>Comment</div>
                        </label>
                    </div>
                </div>
            </div>
        </template>

        <script>
            class XWidget extends HTMLElement {
                #icon;
                #form;
                #location;
                
                #pointerDown;
                #moving;

                constructor() {
                    super();

                    const shadowRoot = this.attachShadow({mode: 'open'});
                    let v = document.getElementById("x-widget-template").content.cloneNode(true);
                    shadowRoot.appendChild(document.getElementById("x-widget-template").content.cloneNode(true));

                    this.#icon = this.#createIcon();

                    this.#form = this.#createForm();

                    this.#pointerDown = false;
                    this.#moving = false;
                    this.#location = "bottom-right";
                }

                connectedCallback() {
                    let test = document.getElementById("button");
                    test.style.position = "absolute";
                    test.style.top = "100px";
                    test.style.left = "100px";
                    test.textContent = "show icon";
                    test.onclick = (e) => {
                        if (!this.#form.classList.contains("hidden")) {
                            this.#renderIcon({visibility: "visible"});
                            this.#renderForm({visibility: "hidden"});
                        }
                    };
                    
                    this.#render();
                }

                #render() {
                    if (this.isConnected) {
                        this.#renderIcon({visibility: "visible"});
                        this.#renderForm({visibility: "hidden"});
                    }
                }

                #createIcon() {
                    let icon = this.shadowRoot.getElementById("icon");

                    icon.addEventListener("pointerdown", (e) => this.#onIconPointerDown(e));
                    icon.addEventListener("pointermove", (e) => this.#onIconPointerMove(e));
                    icon.addEventListener("pointerup", (e) => this.#onIconPointerUp(e));
                    icon.addEventListener("pointerover", (e) => this.#onIconPointerOver(e));
                    icon.addEventListener("pointerout", (e) => this.#onIconPointerOut(e));

                    return icon;
                }

                #createForm() {
                    let form = this.shadowRoot.getElementById("form");

                    let inputName = this.shadowRoot.getElementById("input-name");
                    inputName.addEventListener("input", (e) => this.#onNameInput(e));

                    let selectSeverityContainer = this.shadowRoot.getElementById("select-severity-container");

                    for (let i = 0; i < selectSeverityContainer.childElementCount; i++) {
                        let severityOption = selectSeverityContainer.children[i];
                        severityOption.addEventListener("click", (e) => this.#OnSeverityOptionClicked(e));
                    }

                    let inputComment = this.shadowRoot.getElementById("input-comment");
                    inputComment.addEventListener("input", (e) => this.#onCommentInput(e));

                    return form;
                }

                #renderIcon(parameters={}) {
                    if (this.#location == "top-left") {
                        removeClassByPrefix(this.#icon, "location");
                        this.#icon.classList.add("location-top-left");
                    } 
                    else if (this.#location == "top-right") {
                        removeClassByPrefix(this.#icon, "location");
                        this.#icon.classList.add("location-top-right");
                    } 
                    else if (this.#location == "bottom-left") {
                        removeClassByPrefix(this.#icon, "location");
                        this.#icon.classList.add("location-bottom-left");
                    } 
                    else if (this.#location == "bottom-right") {
                        removeClassByPrefix(this.#icon, "location");
                        this.#icon.classList.add("location-bottom-right");
                    }

                    if (parameters["visibility"]) {
                        if (parameters["visibility"] == "visible") {
                            this.#icon.classList.remove("hidden");
                        }
                        else if (parameters["visibility"] == "hidden") {
                            this.#icon.classList.add("hidden");
                        }
                    }
                }

                #renderForm(parameters={}) {
                    if (this.#location == "top-left") {
                        removeClassByPrefix(this.#form, "location");
                        this.#form.classList.add("location-top-left");
                    } else if (this.#location == "top-right") {
                        removeClassByPrefix(this.#form, "location");
                        this.#form.classList.add("location-top-right");
                    } else if (this.#location == "bottom-left") {
                        removeClassByPrefix(this.#form, "location");
                        this.#form.classList.add("location-bottom-left");
                    } else if (this.#location == "bottom-right") {
                        removeClassByPrefix(this.#form, "location");
                        this.#form.classList.add("location-bottom-right");
                    }

                    if (parameters["visibility"]) {
                        if (parameters["visibility"] == "visible") {
                            this.#form.classList.remove("hidden");
                        }
                        else if (parameters["visibility"] == "hidden") {
                            this.#form.classList.add("hidden");
                        }
                    }
                }

                #onNameInput(e) {
                    let inputName = this.shadowRoot.getElementById("input-name");

                    inputName.setAttribute('value', inputName.value);
                }

                #onCommentInput(e) {
                    let inputComment = this.shadowRoot.getElementById("input-comment");

                    inputComment.setAttribute('value', inputComment.value);
                }

                #OnSeverityOptionClicked(e) {
                    let selectedSeverityOption = e.currentTarget;

                    let selectSeverityContainer = this.shadowRoot.getElementById("select-severity-container");

                    for (let i = 0; i < selectSeverityContainer.childElementCount; i++) {
                        let severityOption = selectSeverityContainer.children[i];
                        
                        if (severityOption == selectedSeverityOption) {
                            if (!severityOption.classList.contains("selected")) {
                                severityOption.classList.add("selected");
                            }
                        }
                        else {
                            severityOption.classList.remove("selected");
                        }
                    }
                }

                #onIconPointerOver(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }

                #onIconPointerOut(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }

                #onIconPointerDown(e) {
                    if (e.button !== 0) {
                        return;
                    }
                    
                    e.preventDefault();
                    e.stopPropagation();

                    this.#pointerDown = true;

                    this.#icon.setPointerCapture(e.pointerId);
                }

                #onIconPointerMove(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    if (this.#pointerDown) {
                        this.#moving = true;
                        this.#icon.style.cursor = "grabbing";
                        this.#snapToCorner(e.clientX, e.clientY);
                    }
                    else {
                        this.#icon.style.cursor = "pointer";
                    }
                }

                #onIconPointerUp(e) {
                    if (e.button !== 0) {
                        return;
                    }
                    
                    e.preventDefault();
                    e.stopPropagation();

                    this.#icon.style.cursor = "pointer";

                    if (!this.#moving) {
                        if (this.#form.classList.contains("hidden")) {
                            this.#renderIcon({visibility: "hidden"});
                            this.#renderForm({visibility: "visible"});
                        }
                    }
                    else {
                        this.#moving = false;
                    }

                    this.#pointerDown = false;

                    this.#icon.releasePointerCapture(e.pointerId);
                }

                #snapToCorner(anchorX, anchorY) {
                    let locationChanged = false;

                    if (anchorX < window.innerWidth / 5) {
                        if (this.#location != "top-left" && anchorY < window.innerHeight / 5) {
                            this.#location = "top-left";
                            locationChanged = true;
                        }
                        else if (this.#location != "bottom-left" && anchorY > window.innerHeight - window.innerHeight / 5) {
                            this.#location = "bottom-left";
                            locationChanged = true;
                        }
                    }
                    else if (anchorX > window.innerWidth - window.innerWidth / 5) {
                        if (this.#location != "top-right" &&  anchorY < window.innerHeight / 5) {
                            this.#location = "top-right";
                            locationChanged = true;
                        }
                        else if (this.#location != "bottom-right" && anchorY > window.innerHeight - window.innerHeight / 5) {
                            this.#location = "bottom-right";
                            locationChanged = true;
                        }
                    }

                    if (locationChanged) {
                        this.#renderIcon({visibility: "visible"});
                        this.#renderForm({visibility: "hidden"});
                    }
                }
            }

            function removeClassByPrefix(el, prefix) {
                if (!el.classList) {
                    return;
                }

                let filteredClassList = [];

                for (let i = 0; i < el.classList.length; i++) {
                    if (!el.classList[i].startsWith(prefix)) {
                        filteredClassList.push(el.classList[i])
                    }
                }

                el.className = "";

                for (let i = 0; i < filteredClassList; i++) {
                    el.classList.add(filteredClassList[i]);
                }
            }

            customElements.define("x-widget", XWidget);
            document.body.appendChild(document.createElement("x-widget"));
        </script>
    </body>
</html> 